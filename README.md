# 🤖 Natural Language KPI Chatbot with Azure OpenAI, SQL & LIDA

An intelligent, interactive Streamlit application that converts business questions into SQL queries using Azure OpenAI, executes them on a connected SQL database, and automatically visualizes the results using LIDA (Language Interface for Data Analysis).

---

## 🧠 How It Works

This chatbot enables C-level executives and analysts to query a SQL database using plain English, without writing a single line of SQL.

## 📊 Project Workflow (Step-by-Step)

### 1. ✨ User Asks a Business Question
Users enter a natural language query in the chat interface.  
Example: _"Show actual and target values for ROE KPI."_

**🔧 Tech Used:**  
`Streamlit` (chat UI)  
`LangChain` (manages prompt and message structure)

---

### 2. ⚖️ LangChain Constructs SQL with Schema Awareness
LangChain uses `ChatPromptTemplate` to build a structured prompt for Azure OpenAI.  
The app dynamically retrieves the schema using `SQLDatabase.get_table_info()` to inject into the prompt.

**🔧 Tech Used:**  
`LangChain`, `AzureChatOpenAI`

---

### 3. ⛏️ SQL Query Generated by Azure OpenAI
Azure OpenAI (ChatGPT) responds with a raw SQL query, without extra text or formatting.  
The SQL is informed by:
- User's question
- Schema from the connected database
- Chat history for context

**🔧 Tech Used:**  
`Azure OpenAI`, `LangChain`, `Microsoft SQL Server`

---

### 4. 📊 SQL Query Execution via SQLAlchemy
The SQL query is executed against a secure Microsoft SQL Server connection.  
Results are returned in a format ready for pandas processing and LLM summarization.

**🔧 Tech Used:**  
`SQLAlchemy`, `pyodbc`, `MSSQL`

---

### 5. 🔎 Natural Language Explanation of Results
A second prompt is used to:
- Interpret the SQL result
- Generate a natural language explanation for executives

**🔧 Tech Used:**  
`LangChain`, `Azure OpenAI`, `Prompt Chaining`

---

### 6. 🔄 Markdown Table Extraction from Response
The LLM’s reply may include a markdown table.  
Regex is used to extract the table, which is then parsed into a pandas DataFrame.

**🔧 Tech Used:**  
`pandas`, `re`

---

### 7. 👜 User Selects Columns for Visualization
Users can choose which columns to view or visualize through a Streamlit sidebar.  
The filtered DataFrame is then prepared for charting.

**🔧 Tech Used:**  
`Streamlit`, `pandas`

---

### 8. 📈 Generate Visuals Using LIDA + Seaborn
The filtered data is exported as CSV and passed to LIDA, which:
- Generates summaries
- Suggests goals
- Creates charts using Seaborn

Charts are rasterized (base64) and displayed using PIL for clean UI integration.

**🔧 Tech Used:**  
`LIDA`, `Seaborn`, `pandas`, `PIL`, `base64`

---

### 9. ✨ Interactive Streamlit Experience
- Chat history is preserved using session state
- Charts and responses update in real-time with every query
- Designed for non-technical users (e.g. executives)

**🔧 Tech Used:**  
`Streamlit`, `LangChain AIMessage & HumanMessage`

---

## ✨ Features

- ✅ Natural language to SQL conversion
- ✅ Context-aware responses from Azure OpenAI
- ✅ Live connection to Microsoft SQL Server
- ✅ Markdown table parsing and data filtering
- ✅ Automated visualizations using LIDA
- ✅ Executive-friendly UI built with Streamlit

---

## 📸 Demo Preview

> Ask questions like:
> - “What is YTD revenue for 2024?”
> - “Compare actual vs target for each KPI”
> - “Visualize marketing spend across quarters”


---

## 🛠 Tech Stack

| Category        | Technologies |
|----------------|--------------|
| LLMs           | Azure OpenAI (via LangChain) |
| Backend        | Python, SQLAlchemy, pyodbc |
| Prompt Logic   | LangChain Templates |
| Visualization  | LIDA (with Seaborn) |
| Frontend       | Streamlit |
| Utilities      | pandas, PIL, base64, regex |

---

## 🚀 Getting Started

### 1. Clone the repository
```bash
git clone https://github.com/shettyrohit0810/kpi-chatbot-azure-sql-lida.git
cd kpi-chatbot-azure-sql-lida
